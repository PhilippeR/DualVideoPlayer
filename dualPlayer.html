<!DOCTYPE html>
<html>

<head>
    <title>Dual Player</title>
    <style>
        #container {
            position: relative;
            width: 1280px;
            /* Adjust as needed */
            height: 720px;
            /* Adjust as needed */
            overflow: hidden;
        }

        #myVideo,
        #myVideo2 {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        #myVideo {
            z-index: 2;
            clip-path: inset(0 50% 0 0);
        }

        #myVideo2 {
            z-index: 1;
        }

        #VideoSeekSlider {
            position: absolute;
            width: 100%;
            bottom: 10px;
            /* Adjust as needed */
            z-index: 3;
        }

        #seekLabel {
            position: absolute;
            width: 100%;
            bottom: 10px;
            /* Adjust as needed */
            z-index: 3;
            color: white;
            background-color: black;
        }

        /* Style for the separator line */
        #separator {
            position: absolute;
            height: 100%;
            width: 2px;
            display: block;
            left: 50%;
            /* Adjust as needed */
            background-color: red;
            z-index: 3;
        }

        /* Style for the video labels */
        .videoName,
        .currenttime {
            position: absolute;
            color: white;
            background-color: black;
            padding: 5px;
            z-index: 3;
        }

        #video1Name {
            top: 0;
            left: 0;
        }

        #video2Name {
            top: 0;
            right: 0;
        }

        #currenttime1 {
            bottom: 30px;
            left: 0;
        }

        #currenttime2 {
            bottom: 30px;
            right: 0;
        }

        #difftime {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>
    <div id="container">
        <video id="myVideo" src="shortvovf1.mp4" type="video/mp4" muted autoplay></video>
        <video id="myVideo2" src="shortvovf2.mp4" type="video/mp4" muted autoplay></video>
        <!-- Separator line -->
        <div id="separator"></div>
        <!-- Video labels -->
        <div id="video1Name" class="videoName"></div>
        <div id="video2Name" class="videoName"></div>
        <!-- Current an diff Time labels -->
        <div id="timedisplay">
            <div id="currenttime1" class="currenttime"></div>
            <div id="currenttime2" class="currenttime"></div>
            <div id="difftime" class="currenttime"></div>
        </div>
        <!-- Slider for seeking -->
        <label id="seekLabel"> Seek
            <input type="range" min="0" max="100" value="0" name="VideoSeekSlider" id="VideoSeekSlider" class="slider">
        </label>
    </div>

    <div id="buttons">
        <br>
        <button onclick="playVideo()">Play</button>
        <button onclick="stopVideo()">Stop</button>
        <button onclick="pauseVideo()">Pause</button>
        <button onclick="rewind()"> &lt;&lt; </button>
        <button onclick="fastForward()"> &gt;&gt; </button>
        <button onclick="toggleTimeDisplay()">Time display ON/OFF</button>
        <button onclick="videoSync()">Players sync</button>
    </div>
    <table>
        <tr>
            <td>
                <label>Player Size:</label>
                <input type="radio" id="size50" name="size" value="50">
                <label for="size50">50%</label>
                <input type="radio" id="size75" name="size" value="75">
                <label for="size75">75%</label>
                <input type="radio" id="size85" name="size" value="85" checked>
                <label for="size95">85%</label>
                <input type="radio" id="size90" name="size" value="90">
                <label for="size95">90%</label>
                <input type="radio" id="size95" name="size" value="95">
                <label for="size95">95%</label>
                <input type="radio" id="size100" name="size" value="100">
                <label for="size95">100%</label>
            <td>
            <td>
                <!-- Slider for container size -->
                <input type="range" min="25" max="100" value="50" class="slider" id="size">
            </td>
        </tr>
    </table>
    <table>
        <tr>
            <td>
                <!-- File inputs for each video -->
                <br>
                <input type="file" id="video1File" title="video1">
                <br>
                <input type="file" id="video2File" title="video2">
                <br>
                <!-- Text inputs for each video URL -->
                <!-- <br>
                <input type="text" id="video1Url" placeholder="URL for video 1">
                <br>
                <input type="text" id="video2Url" placeholder="URL for video 2">
            <td> -->
            <td>
                <!-- Slider for container size -->
                <button onclick="loadVideos()">Load Videos</button>
            </td>
        </tr>
    </table>


    <script>
        var video = document.getElementById("myVideo");
        var video2 = document.getElementById("myVideo2");
        var slider = document.getElementById("PictureSlider");
        var VideoPlayerSizeSlider = document.getElementById("size");
        var VideoSeekSlider = document.getElementById("VideoSeekSlider");
        var container = document.getElementById("container");
        var separator = document.getElementById("separator");
        var timeDisplay = document.getElementById("timedisplay");

        // player video
        function playVideo() {
            video.play();
            video2.play();
        }

        function stopVideo() {
            video.currentTime = 0;
            video.pause();
            video2.currentTime = 0;
            video2.pause();
        }

        function pauseVideo() {
            video.pause();
            video2.pause();
        }
        function fastForward() {
            video.currentTime += 10;
            video2.currentTime += 10;
        }

        function rewind() {
            video.currentTime -= 10;
            video2.currentTime -= 10;
        }
        //video sync
        function videoSync() {

            if (video.currentTime !== video2.currentTime) {
                video2.currentTime = video.currentTime;
                timeupdate1();
                console.log("sync on")
            }
        }
        // display current time of each video
        function timeupdate1() {
            var curtime1 = video.currentTime;
            var curtime2 = video2.currentTime;
            var diff = curtime2 - curtime1
            diff = diff.toFixed(3);
            currenttime1.textContent = convertHHMMSS(curtime1);
            currenttime2.textContent = convertHHMMSS(curtime2);
            difftime.textContent = diff;

        }
        video.addEventListener("timeupdate", timeupdate1);

        // time display on/off 
        function toggleTimeDisplay() {
            if (getComputedStyle(timeDisplay).display != "none") {
                timeDisplay.style.display = "none";
            } else {
                timeDisplay.style.display = "block";
            }
        }
        //load videos
        function loadVideos() {
            var video1File = document.getElementById("video1File");
            var video2File = document.getElementById("video2File");
            var video1Url = document.getElementById("video1Url");
            var video2Url = document.getElementById("video2Url");
            if (video1File.files[0]) {
                video.src = URL.createObjectURL(video1File.files[0]);
                video1Name.textContent = video1File.files[0].name;
            } else if (video1Url.value) {
                video.src = video1Url.value;
                video1Name.textContent = video1Url.value;
            }
            if (video2File.files[0]) {
                video2.src = URL.createObjectURL(video2File.files[0]);
                video2Name.textContent = video2File.files[0].name;
            } else if (video2Url.value) {
                video2.src = video2Url.value;
                video2Name.textContent = video2Url.value;
            }
        }

        // gestion de la zone de separation par la souris
        container.addEventListener('pointerdown', function (event) {
            if (event.button === 0) { // Bouton gauche de la souris
                container.onmousemove = function (event) {
                    var rect = container.getBoundingClientRect();
                    var x = event.clientX - rect.left; // Position X de la souris
                    var width = rect.right - rect.left; // Largeur de la div
                    var percentage = (x / width) * 100; // Position en pourcentage de la largeur de la div
                    video.style.clipPath = "inset(0 " + (100 - percentage) + "% 0 0)";
                    separator.style.left = percentage + "%";
                    console.log('Position horizontale de la souris : ' + percentage + '%');
                }
            }
        });

        container.addEventListener('pointerup', function () {
            container.onmousemove = null; // Arrête de suivre la souris lorsque le bouton est relâché
        });

        // gestion de l'appui sur la barre espace
        window.onkeydown = function (e) {
            if (e.keyCode == 32) { // 32 is the keyCode for the spacebar
                if (video.paused) {
                    playVideo();
                } else {
                    pauseVideo();
                }
                e.preventDefault(); // prevent the default action (scroll / move caret)
            }
        }

        // Event listener for container size radio buttons
        document.querySelectorAll('input[name="size"]').forEach((elem) => {
            elem.addEventListener("change", function (event) {
                container.style.width = event.target.value + "%";
                container.style.height = (event.target.value * 9 / 16) + "vw";
            });
        });

        // gestion VideoPlayerSizeSlider
        VideoPlayerSizeSlider.oninput = function () {
            container.style.width = this.value + "%";
            container.style.height = (this.value * 9 / 16) + "vw";
        }

        // gestion seek slider 
        VideoSeekSlider.oninput = function () {
            var seekTo = video.duration * (VideoSeekSlider.value / 100);
            video.currentTime = seekTo;
            video2.currentTime = seekTo;
            videoSync();
        }

        function convertHHMMSS(currentTime) {
            // // Calcul des heures, minutes et secondes
            let hours = Math.floor(currentTime / 3600);
            let minutes = Math.floor((currentTime - (hours * 3600)) / 60);
            let seconds = Math.floor(currentTime - (hours * 3600) - (minutes * 60));
            let images = Math.floor((currentTime % 1) / 0.04);

            // Ajoute un zéro devant si moins de 10
            if (hours < 10) { hours = "0" + hours; }
            if (minutes < 10) { minutes = "0" + minutes; }
            if (seconds < 10) { seconds = "0" + seconds; }
            if (images < 10) { images = "0" + images; }

            let texteFormat = hours + ':' + minutes + ':' + seconds + ':' + images + 'i';
            return texteFormat;
        }

        // Call the slider.oninput function to position the separator correctly when the page loads
        slider.oninput();
        toggleTimeDisplay();

    </script>
</body>

</html>